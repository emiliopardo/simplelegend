<!DOCTYPE html>
<html>

<head>
    <title>Ejemplo simpleLegend</title>
    <!-- fichero estilos -->
    <link href="https://mapea4-sigc.juntadeandalucia.es/assets/css/mapea-6.0.0.ol.min.css" rel="stylesheet" />

    <!-- ficheros javascript -->
    <script type="text/javascript" src="https://mapea4-sigc.juntadeandalucia.es/js/mapea-6.0.0.ol.min.js"></script>
    <script type="text/javascript" src="https://mapea4-sigc.juntadeandalucia.es/js/configuration-6.0.0.js"></script>

    <!-- Plugin simplebaselayerselector-->
    <script type="text/javascript" src="https://emiliopardo.github.io/simplelegend/simplelegend.ol.min.js"></script>
    <link href="https://emiliopardo.github.io/simplelegend/simplelegend.ol.min.css" rel="stylesheet" />


    <style>
        html,
        body,
        #map {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
</body>
<script type="text/javascript">

    const map = M.map({
        container: 'map',
    });
    map.addControls(['ScaleLine', 'Scale', 'Mouse', 'panzoombar']);

    let layer = new M.layer.WMS({
  url: 'http://www.juntadeandalucia.es/institutodeestadisticaycartografia/geoserver-ieca/direst/wms?',
  name: 'direst_comercio_2018',
  legend: 'Sector Comercio',
  transparent: true
}, {
  params: {
    styles: 'direst_comercio',
    layers: 'direst_comercio_2018',
  }
});

let layer1 = new M.layer.WMS({
  url: 'http://www.juntadeandalucia.es/institutodeestadisticaycartografia/geoserver-ieca/direst/wms?',
  name: 'direst_transporte_2018',
  legend: 'Sector Transporte y almacenamiento',
  transparent: true
}, {
  params: {
    styles: 'direst_transporte',
    layers: 'direst_transporte_2018',
  }
});

let layer2 = new M.layer.WMS({
  url: 'http://www.juntadeandalucia.es/institutodeestadisticaycartografia/geoserver-ieca/direst/wms?',
  name: 'direst_construccion_2018',
  legend: 'Sector Construccion',
  transparent: true
}, {
  params: {
    styles: 'direst_construccion',
    layers: 'direst_construccion_2018',
  }
});

/*FIN TEST RASTER LAYER */


/*INICIO  TEST VECTOR LAYER */


//Capa ise:Agricultura

let agricultura = new M.layer.WFS({
  name: "Agricultura_Ganaderia_Pesca",
  url: "https://www.ideandalucia.es/services/ise/wfs?",
  namespace: "ise",
  legend: "Centros y equipamientos: Agricultura, ganadería y pesca",
  geometry: 'MPOINT',
  extract: true
}, {
  vendor: {
    getFeature: {
      'propertyName': 'Nombre,Tipo,Dependencia,Nivel1,Nivel2,Titularidad,Horario,Direccion,Edificio,Localidad,Municipio,Provincia,Telefono,Fax,Correo_electronico,web,geom'
    }
  }
});

//Asignación de Iconos

let agriculturaOCA = new M.style.Point({
  icon: {
    src: 'https://www.juntadeandalucia.es/institutodeestadisticaycartografia/mapa_equipamientos/geolocalizacion/iconos/Equipamientos/Agricultura/oca.png'
  }
});

let agriculturaAgroclimatica = new M.style.Point({
  icon: {
    src: 'https://www.juntadeandalucia.es/institutodeestadisticaycartografia/mapa_equipamientos/geolocalizacion/iconos/Equipamientos/Agricultura/agroclimatica.png'
  }
});
let agriculturaGrupodr = new M.style.Point({
  icon: {
    src: 'https://www.juntadeandalucia.es/institutodeestadisticaycartografia/mapa_equipamientos/geolocalizacion/iconos/Equipamientos/Agricultura/9_61_gdr.png'
  }
});

//Simbología categorizada

let categoriaAgricultura = new M.style.Category("Nivel2", {
  "Oficinas comarcales y locales agrarias": agriculturaOCA,
  "Información agroclimática": agriculturaAgroclimatica,
  "Grupos de Desarrollo Rural": agriculturaGrupodr
});

//Simbología Cluster
let clusterOptionsAgricultura = {
  ranges: [{
    min: 2,
    max: 100,
    style: new M.style.Point({
      fill: {
        color: 'f28d4e',
        opacity: 1
      },
      stroke: {
        color: '#FFFFFF'
      },
      radius: 12
    })
  }
  ],
  animated: true,
  hoverInteraction: false,
  displayAmount: true,
  selectedInteraction: true,
  maxFeaturesToSelect: 2,
  distance: 100,
  label: {
    font: 'bold 12px Comic Sans MS',
    color: '#FFFFFF'
  }
};

//Parámetros Opcionales Cluster
let vendorParameters = {
  distanceSelectFeatures: 25,
  convexHullStyle: {
    fill: {
      color: '#0000FF',
      opacity: 1
    },
    stroke: {
      color: '#0000FF',
      width: 1
    }
  }
}

//Creación del estilo Cluster
let clusterStyleAgricultura = new M.style.Cluster(clusterOptionsAgricultura, vendorParameters);

//Creación del estilo composite
let compositeAgricultura = categoriaAgricultura.add(clusterStyleAgricultura);

//asignación del estilo final
agricultura.setStyle(compositeAgricultura);
    
const configSimple = {
  title: 'Leyenda',
  draggable: true,
  layers: [agricultura, layer, layer1]
}

map.addLayers([agricultura, layer, layer1]);
const mp = new M.plugin.Simplelegend(configSimple);

map.addPlugin(mp);    

</script>

</html>
